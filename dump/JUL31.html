<script>
  var i,
    j,
    l,
    J,
    end,
    a = "button",
    A = "<",
    B = A + a + " type='" + a,
    b = B + "' id='",
    c = "'></" + a + ">",
    D = "<p id='",
    d = "style",
    E = "'></p>",
    e = ":20px;",
    f = "<br>",
    F = [],
    g = "----",
    h = [37, 39, 40, 38, 90, 88],
    H = "",
    L = [0, 4, 8, 12, 14, 16, 18, 4, 4, 4, 2, 2, 2, 1],
    k = 0,
    K = 1,
    n = [
      "#9400D3",
      "orange",
      "blue",
      "#32cd32",
      "red",
      "#87CEFA",
      "yellow",
      "#bd89d3",
      "#e2c389",
      "#8989e2",
      "#9bd19b",
      "#e28989",
      "#b8d1e1",
      "#e2e289",
      "#d3d3d3"
    ],
    O = "32323232",
    o = "0000111122223344556" + O + O + "142",
    s = [1, 5, 0, 1, 5, 0, 1, 5, 0],
    T = [],
    x = 0,
    t =
      "0125045714561458012401582456047801260147045615781245045801561457047901230145",
    u = [],
    R = 2,
    U = 0,
    W = "",
    X = "New Game",
    m = function() {
      for (i = 0; i < 20; i++) for (j = 0; j < 19; j++) u.push(j);
      u.sort(function() {
        return 0.5 - Math.random();
      }),
        (s[2] = u[0]),
        (s[5] = u[1]),
        (s[8] = u[40]);
    },
    G = function(i, t) {
      document.getElementById(i).style.background = n[t];
    },
    M = function(i) {
      document.write(i);
    },
    I = function(i,t){
      document.getElementById(i).innerHTML = t;
    },
    w = function(i, t, s, e) {
      return 10 * i - 10 + t - T[4 * s + e];
    },
    C = function(i, t, s) {
      G(0 === s ? i : "a" + i, t);
    },
    S = function(t, s, e, n) {
      for (i = 0; i < 4; i++)
        (Q = w(t, s, e, i)),
          n < 2
            ? C(Q, 1 * o[e] + 7 * n, 0)
            : 2 === n
            ? C(Q, 14, 0)
            : C(Q, 3 === n ? o[e] : 14, 1);
    },
    y = function(i, t, s) {
      return (
        F.includes(w(i, t, s, 0)) ||
        F.includes(w(i, t, s, 1)) ||
        F.includes(w(i, t, s, 2)) ||
        F.includes(w(i, t, s, 3))
      );
    };
  for (i = 0; i < t.length; i++) T[i] = [0, 1, 2, 3, 10, 11, 12, 20, 21, 30][t[i]];
  for (
    M(
      "<body onkeydown='P(event)'>" +
        A +
        d +
        ">" +
        a +
        "{border:0px;background: " +
        n[14] +
        ";width" +
        e +
        "height" +
        e +
        "} #e{font-size:45px;}</" +
        d +
        "><table><td>"
    ),
      i = 0;
    i < 20;
    i++
  ) {
    for (j = 0; j < 10; j++) M(b + k + c), k++;
    M(f);
  }
  for (k = -1, i = 0; i < 4; i++) for (j = 0; j < 10; j++) M(D + k + E), k--;
  for (
    k = 0,
      M(
        "</td><td><p id='e'>TETRIS!</p>By Gem Games (2020)" +
          f +
          b +
          "z' style='width:50%;'onclick='b()'>" +
          X +
          "</" +
          a +
          ">" +
          f +
          "Next" +
          g +
          g +
          g +
          " Hold" +
          f
      ),
      i = 0;
    i < 4;
    i++
  ) {
    for (j = 0; j < 10; j++) M(b + "a" + k + c), k++;
    M(f);
  }
  M("</td></table></body>"), (g = !1);
  b = function() {
    if (g) {
      for (g = !1, i = 0; i < 200; i++) G(i, 14);
      for (i = 0; i < 40; i++) G("a" + i, 14);
      I("z", X);
    } else (g = !0), m(), I("z", "Start Over");
  };
  var P = function(t, e) {
      if (g) {
        var n = function(i) {
            return e ? 2 == i : t.keyCode === h[i];
          },
          a = function(i, t, e) {
            S(
              "5" !== o[s[i]] ? 3 : 4,
              "5" !== o[s[i]] ? 3 + e : 2 + e,
              L[o[s[i]]],
              t
            );
          },
          r = function() {
            for (
              a(5, 4, 0), K = 1, s[0]--, S(s[0], s[1], s[2], 0), i = 0;
              i < 4;
              i++
            )
              F.push(w(s[0], s[1], s[2], i));
            for (
              s[0] = s[3],
                s[1] = s[4],
                s[2] = s[5],
                s[5] = u[R],
                R = R + 1 === u.length ? 0 : R + 1,
                a(5, 3, 0),
                j = 0;
              j < 20;
              j++
            ) {
              for (i = 0; i < 10 && !1 !== F.includes(10 * j + i); i++);
              if (10 === i)
                for (i = j; i > 0; i--)
                  for (U= 0; U < 10; U++)
                    (W = 10 * i + U),
                      (document.getElementById(
                        W
                      ).style.background = document.getElementById(
                        W - 10
                      ).style.background),
                      (F[F.indexOf(W)] = W + 10);
            }
          },
          c = function() {
            for (i = s[0]; i < 21 && !y(i, s[1], s[2]); i++) x = i;
          };
        y(1, 6, 17) && I("e", "Game Over!"),
          S(s[0], s[1], s[2], 2),
          S(x, s[1], s[2], 2),
          n(0) && s[1]--,
          n(1) && s[1]++,
          n(2) && s[0]++,
          n(4) &&
            (s[2]++,
            s[2] === L[1 * o[(s[2])]] &&
              (s[2] = L[1 * o[(s[2])] - 1])),
          n(5) &&
            K &&
            ((K = 0),
            a(8, 4, 5),
            (s[0] = 1),
            (s[1] = 5),
            (J = s[2]),
            (s[2] = s[8]),
            (s[8] = J)),
          (10 != s[1] && s[1] != o[s[2] + 19] - 2) ||
            ((n(0) || n(4)) && s[1]++, n(1) && s[1]--),
          y(s[0], s[1], s[2]) && (n(0) && s[1]++, n(1) && s[1]--, n(2) && r()),
          21 === s[0] && n(2) && r(),
          c(),
          S(i - 1, s[1], s[2], 1),
          n(3) && ((s[0] = x + 1), r(), c()),
          S(s[0], s[1], s[2], 0),
          a(5, 3, 0),
          a(8, 3, 5);
      }
    },
    v = function() {
      g && P(null, 1);
    },
    Z = setInterval(v, 700);
</script>
